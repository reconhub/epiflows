<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>01 Data Preparation • epiflows</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="01 Data Preparation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epiflows</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/epiflows-class.html">01 Data Preparation</a>
    </li>
    <li>
      <a href="../articles/introduction.html">00 epiflows: package overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/reconhub/epiflows">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>01 Data Preparation</h1>
            
            <h4 class="date">2018-08-14</h4>
      
      
      <div class="hidden name"><code>epiflows-class.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Epiflows can be constructed from two data frames:</p>
<ul>
<li>
<strong>flows</strong> - Each row represents a flow of cases from one location to another This must have at least three columns:
<ol style="list-style-type: decimal">
<li>The location from where the flow originates</li>
<li>The location where the flow terminates</li>
<li>The number of cases in the flow (can be an absolute number or estimate)</li>
</ol>
</li>
<li>
<strong>locations</strong> - Each row represents a different location located in <strong>flows</strong> with associated metadata. It must have a minimum of one column specifying the location identifier that will match the first two columns of <strong>flows</strong>.</li>
</ul>
<p>The metadata in <strong>locations</strong> such as population size, duration of stay in a given location, date of first and last cases, etc. can be useful in estimating the risk of spread, but not everyone will code their data with identical column names. To facilitate their use in the function <code><a href="../reference/estimate_risk_spread.html">estimate_risk_spread()</a></code>, the epiflows object stores a dictionary of variables in a place called <code>$vars</code>. You can see what variables are stored by default and add varaibles using the <code><a href="../reference/global_vars.html">global_vars()</a></code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"epiflows"</span>)
<span class="co">#&gt; epiflows is loaded with the following global variables in `global_vars()`:</span>
<span class="co">#&gt; coordinates, pop_size, duration_stay, first_date, last_date, num_cases</span>
<span class="kw"><a href="../reference/global_vars.html">global_vars</a></span>()
<span class="co">#&gt; [1] "coordinates"   "pop_size"      "duration_stay" "first_date"   </span>
<span class="co">#&gt; [5] "last_date"     "num_cases"</span></code></pre></div>
<p>When we create our object, we will use these as arguments to tell epiflows which varaibles in our data frame are important.</p>
<p>We have two such data frames containing data from a Yellow Fever outbreak in Brazil (Dorigatti <em>et al.</em>, 2017). We will load these examples into our session:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"epiflows"</span>)
<span class="kw">data</span>(<span class="st">"YF_flows"</span>)
<span class="kw">data</span>(<span class="st">"YF_locations"</span>)
<span class="kw">head</span>(YF_flows)
<span class="co">#&gt;               from    to         n</span>
<span class="co">#&gt; 1   Espirito Santo Italy  2827.572</span>
<span class="co">#&gt; 2     Minas Gerais Italy 15714.103</span>
<span class="co">#&gt; 3   Rio de Janeiro Italy  8163.938</span>
<span class="co">#&gt; 4        Sao Paulo Italy 34038.681</span>
<span class="co">#&gt; 5 Southeast Brazil Italy 76281.763</span>
<span class="co">#&gt; 6   Espirito Santo Spain  3270.500</span>
YF_locations
<span class="co">#&gt;               location_code location_population num_cases_time_window</span>
<span class="co">#&gt; 1            Espirito Santo             3973697                  2600</span>
<span class="co">#&gt; 2              Minas Gerais            20997560                  4870</span>
<span class="co">#&gt; 3            Rio de Janeiro            16635996                   170</span>
<span class="co">#&gt; 4                 Sao Paulo            44749699                   200</span>
<span class="co">#&gt; 5          Southeast Brazil            86356952                  7840</span>
<span class="co">#&gt; 6                 Argentina                  NA                    NA</span>
<span class="co">#&gt; 7                     Chile                  NA                    NA</span>
<span class="co">#&gt; 8                   Germany                  NA                    NA</span>
<span class="co">#&gt; 9                     Italy                  NA                    NA</span>
<span class="co">#&gt; 10                 Paraguay                  NA                    NA</span>
<span class="co">#&gt; 11                 Portugal                  NA                    NA</span>
<span class="co">#&gt; 12                    Spain                  NA                    NA</span>
<span class="co">#&gt; 13           United Kingdom                  NA                    NA</span>
<span class="co">#&gt; 14 United States of America                  NA                    NA</span>
<span class="co">#&gt; 15                  Uruguay                  NA                    NA</span>
<span class="co">#&gt;    first_date_cases last_date_cases length_of_stay</span>
<span class="co">#&gt; 1        2017-01-04      2017-04-30             NA</span>
<span class="co">#&gt; 2        2016-12-19      2017-04-20             NA</span>
<span class="co">#&gt; 3        2017-02-19      2017-05-10             NA</span>
<span class="co">#&gt; 4        2016-12-17      2017-04-20             NA</span>
<span class="co">#&gt; 5        2016-12-17      2017-05-10             NA</span>
<span class="co">#&gt; 6              &lt;NA&gt;            &lt;NA&gt;           10.9</span>
<span class="co">#&gt; 7              &lt;NA&gt;            &lt;NA&gt;           10.3</span>
<span class="co">#&gt; 8              &lt;NA&gt;            &lt;NA&gt;           22.3</span>
<span class="co">#&gt; 9              &lt;NA&gt;            &lt;NA&gt;           30.1</span>
<span class="co">#&gt; 10             &lt;NA&gt;            &lt;NA&gt;            7.3</span>
<span class="co">#&gt; 11             &lt;NA&gt;            &lt;NA&gt;           27.2</span>
<span class="co">#&gt; 12             &lt;NA&gt;            &lt;NA&gt;           27.2</span>
<span class="co">#&gt; 13             &lt;NA&gt;            &lt;NA&gt;           19.5</span>
<span class="co">#&gt; 14             &lt;NA&gt;            &lt;NA&gt;           18.5</span>
<span class="co">#&gt; 15             &lt;NA&gt;            &lt;NA&gt;            8.0</span></code></pre></div>
<p>We want to use these data to estimate the risk of spread to other locations. This can be done with the procedure implemented in the <code><a href="../reference/estimate_risk_spread.html">estimate_risk_spread()</a></code> function, which can take an epiflows object.</p>
</div>
<div id="construction-of-the-epiflows-object-from-data-frames" class="section level1">
<h1 class="hasAnchor">
<a href="#construction-of-the-epiflows-object-from-data-frames" class="anchor"></a>Construction of the epiflows object from data frames</h1>
<p>With these data frames, we can construct the epiflows object using the <code><a href="../reference/make_epiflows.html">make_epiflows()</a></code> function. Note that this assumes that the required columns (<em>id</em>, <em>from</em>, <em>to</em>, and <em>n</em>) are in the correct order. If they aren’t we can specify their locations with the options in <code><a href="../reference/make_epiflows.html">make_epiflows()</a></code>. Type <code>help("make_epiflows")</code> for more details.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ef &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_epiflows.html">make_epiflows</a></span>(<span class="dt">flows         =</span> YF_flows, 
                    <span class="dt">locations     =</span> YF_locations, 
                    <span class="dt">pop_size      =</span> <span class="st">"location_population"</span>,
                    <span class="dt">duration_stay =</span> <span class="st">"length_of_stay"</span>,
                    <span class="dt">num_cases     =</span> <span class="st">"num_cases_time_window"</span>,
                    <span class="dt">first_date    =</span> <span class="st">"first_date_cases"</span>,
                    <span class="dt">last_date     =</span> <span class="st">"last_date_cases"</span>
                   )
<span class="kw">print</span>(ef)
<span class="co">#&gt; </span>
<span class="co">#&gt; /// Epidemiological Flows //</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   // class: epiflows, epicontacts</span>
<span class="co">#&gt;   // 15 locations; 100 flows; directed</span>
<span class="co">#&gt;   // optional variables: pop_size, duration_stay, num_cases, first_date, last_date </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   // locations</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A tibble: 15 x 6</span>
<span class="co">#&gt;    id    location_popula… num_cases_time_… first_date_cases last_date_cases</span>
<span class="co">#&gt;  * &lt;chr&gt;            &lt;dbl&gt;            &lt;dbl&gt; &lt;fct&gt;            &lt;fct&gt;          </span>
<span class="co">#&gt;  1 Espi…          3973697             2600 2017-01-04       2017-04-30     </span>
<span class="co">#&gt;  2 Mina…         20997560             4870 2016-12-19       2017-04-20     </span>
<span class="co">#&gt;  3 Rio …         16635996              170 2017-02-19       2017-05-10     </span>
<span class="co">#&gt;  4 Sao …         44749699              200 2016-12-17       2017-04-20     </span>
<span class="co">#&gt;  5 Sout…         86356952             7840 2016-12-17       2017-05-10     </span>
<span class="co">#&gt;  6 Arge…               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt;  7 Chile               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt;  8 Germ…               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt;  9 Italy               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt; 10 Para…               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt; 11 Port…               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt; 12 Spain               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt; 13 Unit…               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt; 14 Unit…               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt; 15 Urug…               NA               NA &lt;NA&gt;             &lt;NA&gt;           </span>
<span class="co">#&gt; # ... with 1 more variable: length_of_stay &lt;dbl&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   // flows</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; # A tibble: 100 x 3</span>
<span class="co">#&gt;    from             to         n</span>
<span class="co">#&gt;    &lt;chr&gt;            &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Espirito Santo   Italy  2828.</span>
<span class="co">#&gt;  2 Minas Gerais     Italy 15714.</span>
<span class="co">#&gt;  3 Rio de Janeiro   Italy  8164.</span>
<span class="co">#&gt;  4 Sao Paulo        Italy 34039.</span>
<span class="co">#&gt;  5 Southeast Brazil Italy 76282.</span>
<span class="co">#&gt;  6 Espirito Santo   Spain  3270.</span>
<span class="co">#&gt;  7 Minas Gerais     Spain 18176.</span>
<span class="co">#&gt;  8 Rio de Janeiro   Spain  9443.</span>
<span class="co">#&gt;  9 Sao Paulo        Spain 39371.</span>
<span class="co">#&gt; 10 Southeast Brazil Spain 88231.</span>
<span class="co">#&gt; # ... with 90 more rows</span></code></pre></div>
<p>Now we can use this with <code>esitmate_risk_spread()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">incubation &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  <span class="kw">rlnorm</span>(n, <span class="fl">1.46</span>, <span class="fl">0.35</span>)
}

infectious &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  <span class="kw">rnorm</span>(n, <span class="fl">4.5</span>, <span class="fl">1.5</span><span class="op">/</span><span class="fl">1.96</span>)
}
<span class="kw">set.seed</span>(<span class="dv">2017</span><span class="op">-</span><span class="dv">07</span><span class="op">-</span><span class="dv">25</span>)
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimate_risk_spread.html">estimate_risk_spread</a></span>(ef, 
                            <span class="dt">location_code          =</span> <span class="st">"Espirito Santo"</span>,
                            <span class="dt">r_incubation           =</span> incubation,
                            <span class="dt">r_infectious           =</span> infectious,
                            <span class="dt">n_sim                  =</span> <span class="fl">1e5</span>)
<span class="co">#&gt; Exportations done</span>
<span class="co">#&gt; Importations done</span>
res
<span class="co">#&gt;                          mean_cases lower_limit_95CI upper_limit_95CI</span>
<span class="co">#&gt; Italy                     0.2231010        0.1521863        0.3071570</span>
<span class="co">#&gt; Spain                     0.2252568        0.1538359        0.3119207</span>
<span class="co">#&gt; Portugal                  0.2314011        0.1566451        0.3372611</span>
<span class="co">#&gt; Germany                   0.1861744        0.1260291        0.2713440</span>
<span class="co">#&gt; United Kingdom            0.1611980        0.1195965        0.2084865</span>
<span class="co">#&gt; United States of America  0.9241416        0.6255894        1.3469106</span>
<span class="co">#&gt; Argentina                 1.1268870        0.7628361        1.6424064</span>
<span class="co">#&gt; Chile                     0.2644830        0.1790425        0.3854833</span>
<span class="co">#&gt; Uruguay                   0.2405802        0.1628641        0.3506508</span>
<span class="co">#&gt; Paraguay                  0.1618686        0.1213829        0.1924263</span></code></pre></div>
<p>We can use ggplot2 to visualize these data</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"ggplot2"</span>)
res<span class="op">$</span>location &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rownames</span>(res), <span class="kw">rownames</span>(res))
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(res, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> mean_cases, <span class="dt">y =</span> location)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_errorbarh">geom_errorbarh</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">xmin =</span> lower_limit_95CI, <span class="dt">xmax =</span> upper_limit_95CI), <span class="dt">height =</span> .<span class="dv">25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size =</span> <span class="dv">12</span>, <span class="dt">base_family =</span> <span class="st">"Helvetica"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Yellow Fever Spread from Espirito Santo, Brazil"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Number of cases"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">xlim</a></span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>))</code></pre></div>
<p><img src="epiflows-class_files/figure-html/plot-estimate-1.png" width="672"></p>
<p>By default, <code><a href="../reference/estimate_risk_spread.html">estimate_risk_spread()</a></code> returns a summary of the simulations. To obtain the full simulated output, you can set <code>return_all_simulations = TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2017</span><span class="op">-</span><span class="dv">07</span><span class="op">-</span><span class="dv">25</span>)
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimate_risk_spread.html">estimate_risk_spread</a></span>(ef, 
                            <span class="dt">location_code          =</span> <span class="st">"Espirito Santo"</span>,
                            <span class="dt">r_incubation           =</span> incubation,
                            <span class="dt">r_infectious           =</span> infectious,
                            <span class="dt">n_sim                  =</span> <span class="fl">1e5</span>,
                            <span class="dt">return_all_simulations =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Exportations done</span>
<span class="co">#&gt; Importations done</span>
<span class="kw">head</span>(res)
<span class="co">#&gt;          Italy     Spain  Portugal   Germany United Kingdom</span>
<span class="co">#&gt; [1,] 0.1881972 0.1902371 0.1937110 0.1558506      0.1454655</span>
<span class="co">#&gt; [2,] 0.1643659 0.1661475 0.1691815 0.1361153      0.1291680</span>
<span class="co">#&gt; [3,] 0.2300272 0.2325205 0.2367666 0.1904910      0.1643677</span>
<span class="co">#&gt; [4,] 0.2479176 0.2506047 0.2551811 0.2053064      0.1724519</span>
<span class="co">#&gt; [5,] 0.2580284 0.2600902 0.2655881 0.2136794      0.1770208</span>
<span class="co">#&gt; [6,] 0.2005721 0.2027461 0.2064485 0.1660986      0.1510575</span>
<span class="co">#&gt;      United States of America Argentina     Chile   Uruguay  Paraguay</span>
<span class="co">#&gt; [1,]                0.7736187 0.9433412 0.2214082 0.2014016 0.1501050</span>
<span class="co">#&gt; [2,]                0.6756559 0.8238866 0.1933715 0.1758983 0.1310973</span>
<span class="co">#&gt; [3,]                0.9455686 1.1530148 0.2706200 0.2461665 0.1665537</span>
<span class="co">#&gt; [4,]                1.0191100 1.2426903 0.2916674 0.2653121 0.1712946</span>
<span class="co">#&gt; [5,]                1.0606723 1.2933709 0.3035624 0.2761323 0.1739739</span>
<span class="co">#&gt; [6,]                0.8244880 1.0053706 0.2359669 0.2146448 0.1587483</span>
<span class="kw">library</span>(<span class="st">"ggplot2"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(utils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/utils/topics/stack">stack</a></span>(<span class="kw">as.data.frame</span>(res)), <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> ind, <span class="dt">y =</span> values)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_boxplot">geom_boxplot</a></span>(<span class="dt">outlier.alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size =</span> <span class="dv">12</span>, <span class="dt">base_family =</span> <span class="st">"Helvetica"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Yellow Fever Spread from Espirito Santo, Brazil"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"Number of cases"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Location"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">ylim</a></span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/coord_flip">coord_flip</a></span>()</code></pre></div>
<p><img src="epiflows-class_files/figure-html/plot-estimate-sim-1.png" width="672"></p>
</div>
<div id="using-set_vars-to-update-variable-keys-in-the-object" class="section level1">
<h1 class="hasAnchor">
<a href="#using-set_vars-to-update-variable-keys-in-the-object" class="anchor"></a>Using <code><a href="../reference/get_vars.html">set_vars()</a></code> to update variable keys in the object</h1>
<p>In some cases, it may be useful to store several vectors that can represent a single variable in the model and switch them out. These vectors can be stored as separate columns in the data frame and you can use the function <code><a href="../reference/get_vars.html">set_vars()</a></code> to change which column a default variable points to.</p>
<div id="example-different-durations-of-stay" class="section level2">
<h2 class="hasAnchor">
<a href="#example-different-durations-of-stay" class="anchor"></a>Example: different durations of stay</h2>
<div id="data-preparation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>data preparation</h3>
<p>Such a case may arise if you have several different durations of stay based on the location of origin. For example, let’s imagine that this was the case for the Brazilian data. First, we’ll construct some dummy data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"YF_Brazil"</span>)
<span class="kw">set.seed</span>(<span class="dv">5000</span>)
short_stays &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">replicate</span>(<span class="dv">5</span>, <span class="kw">rpois</span>(<span class="dv">10</span>, <span class="dv">5</span>) <span class="op">+</span><span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(<span class="dv">10</span>), <span class="dv">1</span>)))
<span class="kw">colnames</span>(short_stays) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"ES"</span>, <span class="st">"MG"</span>, <span class="st">"RdJ"</span>, <span class="st">"SP"</span>, <span class="st">"SB"</span>)
<span class="kw">rownames</span>(short_stays) &lt;-<span class="st"> </span><span class="kw">names</span>(YF_Brazil<span class="op">$</span>length_of_stay)
short_stays
<span class="co">#&gt;                            ES  MG RdJ   SP  SB</span>
<span class="co">#&gt; Italy                     5.3 6.6 6.8  7.5 8.6</span>
<span class="co">#&gt; Spain                     5.9 2.2 3.3  6.4 3.6</span>
<span class="co">#&gt; Portugal                  3.9 4.1 3.3 10.5 9.2</span>
<span class="co">#&gt; Germany                  10.6 6.5 8.1  7.8 6.8</span>
<span class="co">#&gt; United Kingdom            1.1 4.1 4.1  3.1 7.1</span>
<span class="co">#&gt; United States of America  6.6 5.3 3.0  3.4 3.5</span>
<span class="co">#&gt; Argentina                 7.5 6.4 5.7  5.3 6.6</span>
<span class="co">#&gt; Chile                     1.2 6.8 0.8  4.5 2.7</span>
<span class="co">#&gt; Uruguay                   4.9 8.9 5.6  3.5 7.8</span>
<span class="co">#&gt; Paraguay                  5.2 3.4 5.0  4.9 4.3</span></code></pre></div>
<p>Now, we can merge it with our original locations metadata using the <code>location_code</code> column to join the two together correctly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">short_stays<span class="op">$</span>location_code &lt;-<span class="st"> </span><span class="kw">rownames</span>(short_stays)
(locations &lt;-<span class="st"> </span><span class="kw">merge</span>(YF_locations, short_stays, <span class="dt">by =</span> <span class="st">"location_code"</span>, <span class="dt">all =</span> <span class="ot">TRUE</span>, <span class="dt">sort =</span> <span class="ot">FALSE</span>))
<span class="co">#&gt;               location_code location_population num_cases_time_window</span>
<span class="co">#&gt; 1                 Argentina                  NA                    NA</span>
<span class="co">#&gt; 2                     Chile                  NA                    NA</span>
<span class="co">#&gt; 3                   Germany                  NA                    NA</span>
<span class="co">#&gt; 4                     Italy                  NA                    NA</span>
<span class="co">#&gt; 5                  Paraguay                  NA                    NA</span>
<span class="co">#&gt; 6                  Portugal                  NA                    NA</span>
<span class="co">#&gt; 7                     Spain                  NA                    NA</span>
<span class="co">#&gt; 8            United Kingdom                  NA                    NA</span>
<span class="co">#&gt; 9  United States of America                  NA                    NA</span>
<span class="co">#&gt; 10                  Uruguay                  NA                    NA</span>
<span class="co">#&gt; 11           Espirito Santo             3973697                  2600</span>
<span class="co">#&gt; 12             Minas Gerais            20997560                  4870</span>
<span class="co">#&gt; 13           Rio de Janeiro            16635996                   170</span>
<span class="co">#&gt; 14                Sao Paulo            44749699                   200</span>
<span class="co">#&gt; 15         Southeast Brazil            86356952                  7840</span>
<span class="co">#&gt;    first_date_cases last_date_cases length_of_stay   ES  MG RdJ   SP  SB</span>
<span class="co">#&gt; 1              &lt;NA&gt;            &lt;NA&gt;           10.9  7.5 6.4 5.7  5.3 6.6</span>
<span class="co">#&gt; 2              &lt;NA&gt;            &lt;NA&gt;           10.3  1.2 6.8 0.8  4.5 2.7</span>
<span class="co">#&gt; 3              &lt;NA&gt;            &lt;NA&gt;           22.3 10.6 6.5 8.1  7.8 6.8</span>
<span class="co">#&gt; 4              &lt;NA&gt;            &lt;NA&gt;           30.1  5.3 6.6 6.8  7.5 8.6</span>
<span class="co">#&gt; 5              &lt;NA&gt;            &lt;NA&gt;            7.3  5.2 3.4 5.0  4.9 4.3</span>
<span class="co">#&gt; 6              &lt;NA&gt;            &lt;NA&gt;           27.2  3.9 4.1 3.3 10.5 9.2</span>
<span class="co">#&gt; 7              &lt;NA&gt;            &lt;NA&gt;           27.2  5.9 2.2 3.3  6.4 3.6</span>
<span class="co">#&gt; 8              &lt;NA&gt;            &lt;NA&gt;           19.5  1.1 4.1 4.1  3.1 7.1</span>
<span class="co">#&gt; 9              &lt;NA&gt;            &lt;NA&gt;           18.5  6.6 5.3 3.0  3.4 3.5</span>
<span class="co">#&gt; 10             &lt;NA&gt;            &lt;NA&gt;            8.0  4.9 8.9 5.6  3.5 7.8</span>
<span class="co">#&gt; 11       2017-01-04      2017-04-30             NA   NA  NA  NA   NA  NA</span>
<span class="co">#&gt; 12       2016-12-19      2017-04-20             NA   NA  NA  NA   NA  NA</span>
<span class="co">#&gt; 13       2017-02-19      2017-05-10             NA   NA  NA  NA   NA  NA</span>
<span class="co">#&gt; 14       2016-12-17      2017-04-20             NA   NA  NA  NA   NA  NA</span>
<span class="co">#&gt; 15       2016-12-17      2017-05-10             NA   NA  NA  NA   NA  NA</span></code></pre></div>
<p>Now we can create the epiflows object like we did before, but using our added data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ef &lt;-<span class="st"> </span><span class="kw"><a href="../reference/make_epiflows.html">make_epiflows</a></span>(<span class="dt">flows         =</span> YF_flows, 
                    <span class="dt">locations     =</span> locations, 
                    <span class="dt">pop_size      =</span> <span class="st">"location_population"</span>,
                    <span class="dt">duration_stay =</span> <span class="st">"length_of_stay"</span>,
                    <span class="dt">num_cases     =</span> <span class="st">"num_cases_time_window"</span>,
                    <span class="dt">first_date    =</span> <span class="st">"first_date_cases"</span>,
                    <span class="dt">last_date     =</span> <span class="st">"last_date_cases"</span>
                   )</code></pre></div>
</div>
<div id="using-set_vars" class="section level3">
<h3 class="hasAnchor">
<a href="#using-set_vars" class="anchor"></a>Using <code><a href="../reference/get_vars.html">set_vars()</a></code>
</h3>
<p>We can run the model the same, but now we have the option to switch out which columns from our locations data frame we want to use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_vars.html">get_vars</a></span>(ef)<span class="op">$</span>duration_stay
<span class="co">#&gt; [1] "length_of_stay"</span>
<span class="kw"><a href="../reference/get_vars.html">set_vars</a></span>(ef, <span class="st">"duration_stay"</span>) &lt;-<span class="st"> "ES"</span>
<span class="kw"><a href="../reference/get_vars.html">get_vars</a></span>(ef)<span class="op">$</span>duration_stay
<span class="co">#&gt; [1] "ES"</span>
<span class="kw">set.seed</span>(<span class="dv">2017</span><span class="op">-</span><span class="dv">07</span><span class="op">-</span><span class="dv">25</span>)
incubation &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  <span class="kw">rlnorm</span>(n, <span class="fl">1.46</span>, <span class="fl">0.35</span>)
}

infectious &lt;-<span class="st"> </span><span class="cf">function</span>(n) {
  <span class="kw">rnorm</span>(n, <span class="fl">4.5</span>, <span class="fl">1.5</span><span class="op">/</span><span class="fl">1.96</span>)
}
<span class="kw">set.seed</span>(<span class="dv">2017</span><span class="op">-</span><span class="dv">07</span><span class="op">-</span><span class="dv">25</span>)
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimate_risk_spread.html">estimate_risk_spread</a></span>(ef, 
                            <span class="dt">location_code          =</span> <span class="st">"Espirito Santo"</span>,
                            <span class="dt">r_incubation           =</span> incubation,
                            <span class="dt">r_infectious           =</span> infectious,
                            <span class="dt">n_sim                  =</span> <span class="fl">1e5</span>)
<span class="co">#&gt; Exportations done</span>
<span class="co">#&gt; Importations done</span>
res<span class="op">$</span>location &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rownames</span>(res), <span class="kw">rownames</span>(res))
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(res, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> mean_cases, <span class="dt">y =</span> location)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_errorbarh">geom_errorbarh</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">xmin =</span> lower_limit_95CI, <span class="dt">xmax =</span> upper_limit_95CI), <span class="dt">height =</span> .<span class="dv">25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size =</span> <span class="dv">12</span>, <span class="dt">base_family =</span> <span class="st">"Helvetica"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Yellow Fever Spread from Espirito Santo, Brazil"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Number of cases"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">xlim</a></span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>))</code></pre></div>
<p><img src="epiflows-class_files/figure-html/plot-estimate-dummy-1.png" width="672"></p>
<p>Changing it back is simple:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="../reference/get_vars.html">set_vars</a></span>(ef, <span class="st">"duration_stay"</span>) &lt;-<span class="st"> "length_of_stay"</span>

<span class="kw">set.seed</span>(<span class="dv">2017</span><span class="op">-</span><span class="dv">07</span><span class="op">-</span><span class="dv">25</span>)
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimate_risk_spread.html">estimate_risk_spread</a></span>(ef, 
                            <span class="dt">location_code          =</span> <span class="st">"Espirito Santo"</span>,
                            <span class="dt">r_incubation           =</span> incubation,
                            <span class="dt">r_infectious           =</span> infectious,
                            <span class="dt">n_sim                  =</span> <span class="fl">1e5</span>)
<span class="co">#&gt; Exportations done</span>
<span class="co">#&gt; Importations done</span>
res<span class="op">$</span>location &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rownames</span>(res), <span class="kw">rownames</span>(res))
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(res, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> mean_cases, <span class="dt">y =</span> location)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_errorbarh">geom_errorbarh</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">xmin =</span> lower_limit_95CI, <span class="dt">xmax =</span> upper_limit_95CI), <span class="dt">height =</span> .<span class="dv">25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size =</span> <span class="dv">12</span>, <span class="dt">base_family =</span> <span class="st">"Helvetica"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Yellow Fever Spread from Espirito Santo, Brazil"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Number of cases"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">xlim</a></span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>))</code></pre></div>
<p><img src="epiflows-class_files/figure-html/plot-estimate-dummy2-1.png" width="672"></p>
</div>
<div id="using-a-custom-argument" class="section level3">
<h3 class="hasAnchor">
<a href="#using-a-custom-argument" class="anchor"></a>Using a custom argument</h3>
<p>Or, you can specify it by adding it as an argument in the function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2017</span><span class="op">-</span><span class="dv">07</span><span class="op">-</span><span class="dv">25</span>)
res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimate_risk_spread.html">estimate_risk_spread</a></span>(ef, 
                            <span class="dt">location_code          =</span> <span class="st">"Espirito Santo"</span>,
                            <span class="dt">r_incubation           =</span> incubation,
                            <span class="dt">r_infectious           =</span> infectious,
                            <span class="dt">n_sim                  =</span> <span class="fl">1e5</span>,
                            <span class="dt">avg_length_stay_days   =</span> <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">10</span>))
<span class="co">#&gt; Exportations done</span>
<span class="co">#&gt; Importations done</span>
res<span class="op">$</span>location &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rownames</span>(res), <span class="kw">rownames</span>(res))
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(res, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> mean_cases, <span class="dt">y =</span> location)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>(<span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_errorbarh">geom_errorbarh</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">xmin =</span> lower_limit_95CI, <span class="dt">xmax =</span> upper_limit_95CI), <span class="dt">height =</span> .<span class="dv">25</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>(<span class="dt">base_size =</span> <span class="dv">12</span>, <span class="dt">base_family =</span> <span class="st">"Helvetica"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Yellow Fever Spread from Espirito Santo, Brazil"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">"Number of cases"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/lims">xlim</a></span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>))</code></pre></div>
<p><img src="epiflows-class_files/figure-html/plot-estimate-dummy3-1.png" width="672"></p>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<p>Dorigatti I, Hamlet A, Aguas R, Cattarino L, Cori A, Donnelly CA, Garske T, Imai N, Ferguson NM. International risk of yellow fever spread from the ongoing outbreak in Brazil, December 2016 to May 2017. Euro Surveill. 2017;22(28):pii=30572. DOI: <a href="https://doi.org/10.2807/1560-7917.ES.2017.22.28.30572">10.2807/1560-7917.ES.2017.22.28.30572</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#construction-of-the-epiflows-object-from-data-frames">Construction of the epiflows object from data frames</a></li>
      <li>
<a href="#using-set_vars-to-update-variable-keys-in-the-object">Using <code><a href="--/reference/get_vars-html">set_vars()</a></code> to update variable keys in the object</a><ul class="nav nav-pills nav-stacked">
<li><a href="#example-different-durations-of-stay">Example: different durations of stay</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Pawel Piatkowski, Paula Moraga, Thibaut Jombart, VP Nagraj, Zhian N. Kamvar, Salla E. Toikkanen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
